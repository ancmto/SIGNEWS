<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Teste Supabase - Programas</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h1>Teste de Conex√£o Supabase</h1>
  <div id="result"></div>

  <script>
    const { createClient } = supabase;

    const supabaseUrl = 'https://joqtrwieeuytpnivqomd.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpvcXRyd2llZXV5dHBuaXZxb21kIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NzMxNDksImV4cCI6MjA4MjU0OTE0OX0.SBZi8_9Umpv4LF3ACsM70jobCVQSlSUfSI2VvzDp0nI';

    const client = createClient(supabaseUrl, supabaseKey);

    async function testConnection() {
      const resultDiv = document.getElementById('result');

      try {
        console.log('üîÑ Testando conex√£o com Supabase...');
        resultDiv.innerHTML = '<p>üîÑ Carregando programas...</p>';

        const { data, error } = await client
          .from('programas')
          .select('*')
          .eq('ativo', true)
          .is('deleted_at', null)
          .order('nome');

        if (error) {
          console.error('‚ùå Erro:', error);
          resultDiv.innerHTML = `
            <h2 style="color: red;">‚ùå Erro ao carregar programas</h2>
            <pre>${JSON.stringify(error, null, 2)}</pre>
          `;
          return;
        }

        console.log('‚úÖ Programas carregados:', data);

        if (data && data.length > 0) {
          resultDiv.innerHTML = `
            <h2 style="color: green;">‚úÖ Sucesso! ${data.length} programas encontrados</h2>
            <ul>
              ${data.map(p => `<li><strong>${p.nome}</strong> - ${p.descricao}</li>`).join('')}
            </ul>
            <h3>Dados completos:</h3>
            <pre>${JSON.stringify(data, null, 2)}</pre>
          `;
        } else {
          resultDiv.innerHTML = `
            <h2 style="color: orange;">‚ö†Ô∏è Nenhum programa encontrado</h2>
            <p>A tabela existe mas est√° vazia. Execute o INSERT do seed data.</p>
          `;
        }
      } catch (err) {
        console.error('‚ùå Erro na requisi√ß√£o:', err);
        resultDiv.innerHTML = `
          <h2 style="color: red;">‚ùå Erro na requisi√ß√£o</h2>
          <pre>${err.message}</pre>
        `;
      }
    }

    // Executa o teste ao carregar a p√°gina
    testConnection();
  </script>
</body>
</html>
